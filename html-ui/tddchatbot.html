<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador Â  
 de Tests para Chatbot</title>
    </head>
<body>
    <h1>Creador de Tests</h1>

    <div id="test-container">
        </div>
    
    <!-- Elementos para mostrar progreso -->
    <!-- <progress></progress> https://html.spec.whatwg.org/multipage/form-elements.html#the-progress-element -->

    <input id="credentials" type="password" placeholder="credentials" />

    <input id="question" type="text" placeholder="question"/>
    <input id="response-evaluation" type="text" placeholder="response evaluation"/>
    <button id="add-question">Add test</button>
    <button id="run-all">Run all</button>
    <label for="resultado">Result:</label>
    <input type="text" id="resultado" readonly value="passed">

    <script>
        const addQuestionButton = document.getElementById('add-question');
        const runAllButton = document.getElementById('run-all');
        const questionInput = document.getElementById('question');
        const responseEvaluationInput = document.getElementById('response-evaluation');
        const resultInput = document.getElementById('resultado');
        const testContainer = document.getElementById('test-container');
        const credentials = document.getElementById('credentials');


        async function getChatCompletion(question){
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${credentials.value}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: "user",
                                    content: [
                                    {
                                        type: "text",
                                        text: question
                                    }
                                ]
                                }
                            ],
                            n: 1,
                            stop: null,
                            temperature: 0.5
                        })
                    });

                    const data = await response.json();
                    const generatedResponse = data.choices[0].message.content.trim();
                    return generatedResponse
        }

        runAllButton.addEventListener('click', async () => {
            const response = await getChatCompletion(questionInput.value)
            const responseEvaluation = await getChatCompletion(`Is the text "${response}" matching the criteria "${responseEvaluationInput.value}"? answer only "true" or "false"`)

            let testPassed = responseEvaluation.indexOf("true") != -1
            resultInput.value = testPassed ? "passed" : "failed";
        });
    </script>

    </body>
</html>